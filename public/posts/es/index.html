<!doctype html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Liste - http://localhost:1313/">
    <title>Lesson learned with Elasticsearch | Working with code with feelings</title>
    <meta name="description" content="so what the hell again ja eikö tällainen sekoilu ole jo lopetettu">
    <meta property="og:url" content="http://localhost:1313/posts/es/">
  <meta property="og:site_name" content="Working with code with feelings">
  <meta property="og:title" content="Lesson learned with Elasticsearch">
  <meta property="og:description" content="I made a bang, and completely crashed one of our test environments.
It was surprisingly easy!
I made a database migration which touched 900&#43; Datomic entities, which each could have have 0-n entities under them, and those could also have so many too many entities under them.
Migration and Datomic transactor, no problem, everything went well and got updated as planned.
After that, ES started to work and index all of these new changes. Runs out of heap memory, big time. Server crashes and restarts as it’s told to do, but what does it do when it restarts? It wants to index the ES stuff… What happens when it wants to index all the stuff it run OOM last time it tried to do that? It crashes. And restarts. And crashes XD">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-03T00:00:00+00:00">

    
  <meta itemprop="name" content="Lesson learned with Elasticsearch">
  <meta itemprop="description" content="I made a bang, and completely crashed one of our test environments.
It was surprisingly easy!
I made a database migration which touched 900&#43; Datomic entities, which each could have have 0-n entities under them, and those could also have so many too many entities under them.
Migration and Datomic transactor, no problem, everything went well and got updated as planned.
After that, ES started to work and index all of these new changes. Runs out of heap memory, big time. Server crashes and restarts as it’s told to do, but what does it do when it restarts? It wants to index the ES stuff… What happens when it wants to index all the stuff it run OOM last time it tried to do that? It crashes. And restarts. And crashes XD">
  <meta itemprop="datePublished" content="2025-10-03T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-10-03T00:00:00+00:00">
  <meta itemprop="wordCount" content="164">
    
    <link rel="canonical" href="http://localhost:1313/posts/es/">
    <link rel="icon" href="http://localhost:1313//assets/favicon.ico">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link href="https://www.google-analytics.com" rel="preconnect" crossorigin>
    <link rel="alternate" type="application/atom+xml" title="Working with code with feelings" href="http://localhost:1313//atom.xml" />
    <link rel="alternate" type="application/json" title="Working with code with feelings" href="http://localhost:1313//feed.json" />
    <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bricolage+Grotesque">
    
    <style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 bricolage grotesque,-apple-system,BlinkMacSystemFont,segoe ui,Helvetica,Arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;background:#001417;color:#f3f4f6}.skip-link{position:absolute;top:-40px;left:0;background:#08385e;z-index:100}.skip-link:focus{top:0}h2{color:#77d205}header{display:flex;justify-content:space-between;align-items:center;position:relative;padding-bottom:1rem}header .burger{display:none;background:0 0;border:none;padding:0;cursor:pointer}header .burger span{display:block;width:25px;height:3px;background:#000;margin:5px 0;transition:all .3s ease}@media(max-width:768px){header .burger{display:block;z-index:2}header .nav-menu{position:fixed;top:0;right:-100%;width:100%;height:100vh;background:#fffdfa;padding:2rem;transition:.3s ease;z-index:1}header .nav-menu.active{right:0}header .nav-menu ul{flex-direction:column;align-items:center;width:100%}header .nav-menu ul li{display:block;font-size:1.2rem;border-bottom:1px dotted #000;height:50px;display:flex;justify-content:center;align-items:center}header.menu-open .burger span:first-child{transform:rotate(45deg)translate(5px,6px)}header.menu-open .burger span:nth-child(2){opacity:0}header.menu-open .burger span:last-child{transform:rotate(-45deg)translate(5px,-6px)}}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{margin:.1rem;border:none;overflow:visible;overflow-wrap:anywhere}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}.post-date{margin:5% 0}.index-date{color:#9a9a9a}.animate-blink{animation:opacity 1s infinite;opacity:1}@keyframes opacity{0%{opacity:1}50%{opacity:.5}100%{opacity:0}}.tags{display:flex;justify-content:space-between}.tags ul{padding:0;margin:0}.tags li{display:inline}.avatar{height:140px;width:140px;position:relative;margin:-10px 0 0 15px;float:right;border-radius:50%}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;text-align:left;padding:8px}th{background-color:#f2f2f2}</style>
  
    
    
    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "posts",
        "name": "Lesson learned with Elasticsearch",
        "headline": "Lesson learned with Elasticsearch",
        "alternativeHeadline": "",
        "description": "\u003cp\u003eI made a bang, and completely crashed one of our test environments.\u003c\/p\u003e\n\u003cp\u003eIt was surprisingly easy!\u003c\/p\u003e\n\u003cp\u003eI made a database migration which touched 900\u002b Datomic entities, which each could have have 0-n entities under them, and those could also\nhave so many too many entities under them.\u003cbr\u003e\nMigration and Datomic transactor, no problem, everything went well and got updated as planned.\u003cbr\u003e\nAfter that, ES started to work and index all of these new changes. Runs out of heap memory, big time.\n\u003cbr\u003eServer crashes and restarts as it\u0026rsquo;s told to do, but what does it do when it restarts? It wants to index the ES stuff\u0026hellip;\n\u003cbr\u003eWhat happens when it wants to index all the stuff it run OOM last time it tried to do that? \u003cbr\u003e\nIt crashes. And restarts. And crashes XD\u003c\/p\u003e",
        "inLanguage": "en-gb",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/es\/"
        },
        "author" : {
            "@type": "Person",
            "name": ""
        },
        "creator" : {
            "@type": "Person",
            "name": ""
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": ""
        },
        "copyrightHolder" : "Working with code with feelings",
        "copyrightYear" : "2025",
        "dateCreated": "2025-10-03T00:00:00.00Z",
        "datePublished": "2025-10-03T00:00:00.00Z",
        "dateModified": "2025-10-03T00:00:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Working with code with feelings",
            "url": "http://localhost:1313/",
            "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/localhost:1313\/assets\/favicon.ico",
                "width":"32",
                "height":"32"
            }
        },
        "image": "http://localhost:1313/assets/favicon.ico",
        "url" : "http:\/\/localhost:1313\/posts\/es\/",
        "wordCount" : "164",
        "genre" : [ ],
        "keywords" : [ ]
    }
    </script>
     

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const burger = document.querySelector('.burger');
            const nav = document.querySelector('.nav-menu');
            const header = document.querySelector('header');
        
            if (burger) {
                burger.addEventListener('click', () => {
                    nav.classList.toggle('active');
                    header.classList.toggle('menu-open');
                });
        
                
                document.addEventListener('click', (e) => {
                    if (!header.contains(e.target) && nav.classList.contains('active')) {
                        nav.classList.remove('active');
                        header.classList.remove('menu-open');
                    }
                });
            }
        });
    </script> 
  </head>

<body>
  <a class="skip-link" href="#main">Skip to main</a>
  <main id="main">
  <div class="content">
    
<header>
  <p style="padding: 0;margin: 0;">
    <a href="http://localhost:1313/">
      <b>Working with code with feelings</b>
      <span class="text-stone-500 animate-blink">▮</span>
    </a>
  </p>

  
  <button class="burger" aria-label="Toggle menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <nav class="nav-menu">
    <ul style="padding: 0;margin: 0;">
      
      
        <li class="">
          <a href="/posts/"><span>Posts</span></a>
        </li>
      
        <li class="">
          <a href="/who/"><span>Who?</span></a>
        </li>
      
    </ul>
  </nav>
  
</header>
<hr class="hr-list" style="padding: 0;margin: 0;">
    <section>
      <h2 class="post">Lesson learned with Elasticsearch</h2>
      <p>I made a bang, and completely crashed one of our test environments.</p>
<p>It was surprisingly easy!</p>
<p>I made a database migration which touched 900+ Datomic entities, which each could have have 0-n entities under them, and those could also
have so many too many entities under them.<br>
Migration and Datomic transactor, no problem, everything went well and got updated as planned.<br>
After that, ES started to work and index all of these new changes. Runs out of heap memory, big time.
<br>Server crashes and restarts as it&rsquo;s told to do, but what does it do when it restarts? It wants to index the ES stuff&hellip;
<br>What happens when it wants to index all the stuff it run OOM last time it tried to do that? <br>
It crashes. And restarts. And crashes XD</p>
<p>Lesson learned:<br>
Whenever making a migration that feels slightly bigger that just touching one or two rows: consider whether it really needs to be indexed in ES right away or maybe not?</p>

      
      <div class="post-date">
        <span class="g time">October 3, 2025 </span> &#8729;
         
      </div>
      
    </section>
    
    
    
  </div>
</main>
</body>
</html>
